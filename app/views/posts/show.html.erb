

<div class="float-right">
<%= form_tag posts_path, :method => 'get' do %>
<p>
	<%= text_field_tag :search, params[:search] %>
	<%= submit_tag "Search", :title => nil %>
</p>
<% end %>
</div>


<p id="notice"><%= notice %></p>

<h2><%= @post.title %></h2>
<div id='star-rating'></div>

<div class="float-right">
<td><%= link_to "編集", edit_post_path(@post.id) %></td>
<td><%= link_to "削除", post_path(@post.id), method: :delete, data: { confirm: '削除しますか?' } %></td>
</div>

<br><hr>
<td><%= @post.likes.count %> 件のいいね</td>
<td><%= @post.comments.count %> 件のコメント</td>
<hr>


<p><%=raw @post.body %></p>
<ul class='pl-4'>
	<% @post.body.scan(/(<img(?:.+?)>)/).flatten.each do | image | %>
	<% end %>
</ul>
<hr>


<td>価格</td>
<td><%= @post.price %>円</td>
<hr>

<h2>コメント一覧</h2>
<% @comments.first(8).each do |c| %>
<div>
	<%= c.user.name %>
	<%= c.content %>
	<hr>
</div>
<% end %>

<p><%= link_to "すべてのコメントを表示", all_comment_path(@post.id) %></p>

<%= form_for [@post, @comment] do |f| %>
<%= f.text_field :content %>
<%= f.hidden_field :user_id, :value => current_user.id %>
<%= f.hidden_field :post_id, :value => @post.id %>
<br>
<%= f.submit 'コメントする' %>
<% end %>

<% if current_user.already_liked?(@post) %>
<%= button_to 'いいねを取り消す', post_like_path(@post), method: :delete %>
<% else %>
<%= form_for [@post, @like] do |f| %>
<%= f.hidden_field :user_id, :value => current_user.id %>
<%= f.hidden_field :post_id, :value => @post.id %>
<p><%= f.submit 'いいね' %></p>
<% end %>

<% end %>
<p>いいねしたユーザー</p>
<% @post.liked_users.each do |user| %>
<li><%= user.name %></li>
<% end %>

<script>
$('#star-rating').raty({
readOnly: true,
path: '/assets/',
number: 5,
score: <%= @post.rating %>
});
</script>